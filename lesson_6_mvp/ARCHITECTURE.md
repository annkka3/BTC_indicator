# –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ Alt Forecast Bot

## üìö –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ
1. [–û–±–∑–æ—Ä –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã](#–æ–±–∑–æ—Ä-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã)
2. [Clean Architecture - —Å–ª–æ–∏](#clean-architecture---—Å–ª–æ–∏)
3. [–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞](#—Å—Ç—Ä—É–∫—Ç—É—Ä–∞-–ø—Ä–æ–µ–∫—Ç–∞)
4. [–ü–∞—Ç—Ç–µ—Ä–Ω—ã –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è](#–ø–∞—Ç—Ç–µ—Ä–Ω—ã-–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)
5. [–ü–æ—Ç–æ–∫–∏ –¥–∞–Ω–Ω—ã—Ö](#–ø–æ—Ç–æ–∫–∏-–¥–∞–Ω–Ω—ã—Ö)
6. [–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã](#–∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã-—Å–∏—Å—Ç–µ–º—ã)

---

## –û–±–∑–æ—Ä –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

–ü—Ä–æ–µ–∫—Ç –ø–æ—Å—Ç—Ä–æ–µ–Ω –Ω–∞ –ø—Ä–∏–Ω—Ü–∏–ø–∞—Ö **Clean Architecture** (–ß–∏—Å—Ç–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã), —á—Ç–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç:
- ‚úÖ –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ –º–µ–∂–¥—É —Å–ª–æ—è–º–∏
- ‚úÖ –ù–µ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏ –æ—Ç –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã
- ‚úÖ –õ–µ–≥–∫–æ—Å—Ç—å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- ‚úÖ –†–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ—Å—Ç—å

### –û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã

1. **Dependency Rule**: –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ —Å–ª–æ–∏ –Ω–µ –∑–∞–≤–∏—Å—è—Ç –æ—Ç –≤–Ω–µ—à–Ω–∏—Ö
2. **Single Responsibility**: –ö–∞–∂–¥—ã–π –∫–ª–∞—Å—Å –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –æ–¥–Ω—É –∑–∞–¥–∞—á—É
3. **Dependency Injection**: –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä
4. **Factory Pattern**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ñ–∞–±—Ä–∏–∫ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –æ–±—ä–µ–∫—Ç–æ–≤

---

## Clean Architecture - —Å–ª–æ–∏

### üéØ Domain Layer (–î–æ–º–µ–Ω–Ω—ã–π —Å–ª–æ–π)
**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ**: `app/domain/`

–°–æ–¥–µ—Ä–∂–∏—Ç –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É –∏ –º–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö, –Ω–µ –∑–∞–≤–∏—Å—è—â–∏–µ –æ—Ç –≤–Ω–µ—à–Ω–∏—Ö –±–∏–±–ª–∏–æ—Ç–µ–∫.

**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã**:
- `models.py` - –¥–æ–º–µ–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏
- `services.py` - –¥–æ–º–µ–Ω–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã
- `divergence_detector.py` - –ª–æ–≥–∏–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –¥–∏–≤–µ—Ä–≥–µ–Ω—Ü–∏–π
- `chart_settings.py` - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≥—Ä–∞—Ñ–∏–∫–æ–≤

**–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏**:
- –ù–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –¥—Ä—É–≥–∏—Ö —Å–ª–æ–µ–≤
- –°–æ–¥–µ—Ä–∂–∏—Ç —á–∏—Å—Ç—É—é –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É
- –õ–µ–≥–∫–æ —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç—Å—è

### üì± Application Layer (–°–ª–æ–π –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è)
**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ**: `app/application/`

–°–æ–¥–µ—Ä–∂–∏—Ç –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏ use cases.

**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã**:
- `services/` - —Å–µ—Ä–≤–∏—Å—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:
  - `market_data_service.py` - —Ä–∞–±–æ—Ç–∞ —Å —Ä—ã–Ω–æ—á–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
  - `bubbles_service.py` - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –ø—É–∑—ã—Ä—å–∫–æ–≤—ã—Ö –¥–∏–∞–≥—Ä–∞–º–º
  - `forecast_service.py` - ML –ø—Ä–æ–≥–Ω–æ–∑—ã
  - `twap_service.py` - —Ä–∞—Å—á–µ—Ç TWAP
  - `traditional_markets_service.py` - —Ç—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω—ã–µ —Ä—ã–Ω–∫–∏
- `dto/` - Data Transfer Objects:
  - `bubbles_dto.py` - DTO –¥–ª—è –ø—É–∑—ã—Ä—å–∫–æ–≤
- `usecases/` - use cases:
  - `analytics.py` - –∞–Ω–∞–ª–∏—Ç–∏–∫–∞
  - `generate_report.py` - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á–µ—Ç–æ–≤
  - `ingest_bar.py` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –±–∞—Ä–æ–≤

**–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏**:
- –ó–∞–≤–∏—Å–∏—Ç —Ç–æ–ª—å–∫–æ –æ—Ç Domain Layer
- –°–æ–¥–µ—Ä–∂–∏—Ç –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ —á–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã

### üñ•Ô∏è Presentation Layer (–°–ª–æ–π –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è)
**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ**: `app/presentation/`

–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º (Telegram Bot).

**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã**:
- `handlers/` - –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–º–∞–Ω–¥:
  - `base_handler.py` - –±–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å –¥–ª—è –≤—Å–µ—Ö handlers
  - `command_handler.py` - –±–∞–∑–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã (start, help, info)
  - `bubbles_handler.py` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø—É–∑—ã—Ä—å–∫–æ–≤
  - `chart_handler.py` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≥—Ä–∞—Ñ–∏–∫–æ–≤
  - `forecast_handler.py` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–æ–≥–Ω–æ–∑–æ–≤
  - `indices_handler.py` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏–Ω–¥–µ–∫—Å–æ–≤ (F&G, Altseason)
  - `analytics_handler.py` - –∞–Ω–∞–ª–∏—Ç–∏–∫–∞
  - `handler_factory.py` - —Ñ–∞–±—Ä–∏–∫–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è handlers
- `formatters/` - —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π:
  - `message_formatter.py` - —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
- `integration/` - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è:
  - `command_integrator.py` - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –∫–æ–º–∞–Ω–¥

**–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏**:
- –ó–∞–≤–∏—Å–∏—Ç –æ—Ç Application Layer
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –≤–≤–æ–¥
- –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç –≤—ã–≤–æ–¥ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### üîß Infrastructure Layer (–°–ª–æ–π –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã)
**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ**: `app/infrastructure/`

–°–æ–¥–µ—Ä–∂–∏—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é –≤–Ω–µ—à–Ω–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π.

**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã**:
- `repositories/` - —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏:
  - `base_repository.py` - –±–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å
  - `user_repository.py` - —Ä–∞–±–æ—Ç–∞ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
  - `subscription_repository.py` - —Ä–∞–±–æ—Ç–∞ —Å –ø–æ–¥–ø–∏—Å–∫–∞–º–∏
- `db.py` - —Ä–∞–±–æ—Ç–∞ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö (SQLite)
- `telegram_bot.py` - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Telegram Bot API
- `coingecko.py` - —Ä–∞–±–æ—Ç–∞ —Å CoinGecko API
- `coinglass.py` - —Ä–∞–±–æ—Ç–∞ —Å Coinglass API
- `binance_options.py` - —Ä–∞–±–æ—Ç–∞ —Å Binance Options API
- `cache.py` - –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ
- `ui_keyboards.py` - –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã Telegram
- `ui_router.py` - —Ä–æ—É—Ç–µ—Ä –¥–ª—è callback'–æ–≤

**–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏**:
- –ó–∞–≤–∏—Å–∏—Ç –æ—Ç –≤—Å–µ—Ö –¥—Ä—É–≥–∏—Ö —Å–ª–æ–µ–≤
- –†–µ–∞–ª–∏–∑—É–µ—Ç –≤–Ω–µ—à–Ω–∏–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
- –°–æ–¥–µ—Ä–∂–∏—Ç –¥–µ—Ç–∞–ª–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

---

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
app/
‚îú‚îÄ‚îÄ domain/              # Domain Layer
‚îÇ   ‚îú‚îÄ‚îÄ models.py
‚îÇ   ‚îú‚îÄ‚îÄ services.py
‚îÇ   ‚îú‚îÄ‚îÄ divergence_detector.py
‚îÇ   ‚îî‚îÄ‚îÄ chart_settings.py
‚îÇ
‚îú‚îÄ‚îÄ application/         # Application Layer
‚îÇ   ‚îú‚îÄ‚îÄ services/       # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ market_data_service.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ bubbles_service.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ forecast_service.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ twap_service.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ traditional_markets_service.py
‚îÇ   ‚îú‚îÄ‚îÄ dto/           # Data Transfer Objects
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ bubbles_dto.py
‚îÇ   ‚îî‚îÄ‚îÄ usecases/      # Use Cases
‚îÇ       ‚îú‚îÄ‚îÄ analytics.py
‚îÇ       ‚îú‚îÄ‚îÄ generate_report.py
‚îÇ       ‚îî‚îÄ‚îÄ ingest_bar.py
‚îÇ
‚îú‚îÄ‚îÄ presentation/        # Presentation Layer
‚îÇ   ‚îú‚îÄ‚îÄ handlers/      # –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–º–∞–Ω–¥
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ base_handler.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ command_handler.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ bubbles_handler.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ chart_handler.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ forecast_handler.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ indices_handler.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ analytics_handler.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ handler_factory.py
‚îÇ   ‚îú‚îÄ‚îÄ formatters/    # –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ message_formatter.py
‚îÇ   ‚îî‚îÄ‚îÄ integration/   # –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
‚îÇ       ‚îî‚îÄ‚îÄ command_integrator.py
‚îÇ
‚îú‚îÄ‚îÄ infrastructure/      # Infrastructure Layer
‚îÇ   ‚îú‚îÄ‚îÄ repositories/  # –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ base_repository.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ user_repository.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ subscription_repository.py
‚îÇ   ‚îú‚îÄ‚îÄ db.py          # –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îú‚îÄ‚îÄ telegram_bot.py # Telegram Bot
‚îÇ   ‚îú‚îÄ‚îÄ coingecko.py   # CoinGecko API
‚îÇ   ‚îú‚îÄ‚îÄ coinglass.py   # Coinglass API
‚îÇ   ‚îú‚îÄ‚îÄ cache.py       # –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ
‚îÇ   ‚îú‚îÄ‚îÄ ui_keyboards.py # –ö–ª–∞–≤–∏–∞—Ç—É—Ä—ã
‚îÇ   ‚îî‚îÄ‚îÄ ui_router.py   # –†–æ—É—Ç–µ—Ä
‚îÇ
‚îú‚îÄ‚îÄ ml/                 # Machine Learning
‚îÇ   ‚îú‚îÄ‚îÄ model.py
‚îÇ   ‚îú‚îÄ‚îÄ forecaster.py
‚îÇ   ‚îú‚îÄ‚îÄ features.py
‚îÇ   ‚îî‚îÄ‚îÄ data_adapter.py
‚îÇ
‚îú‚îÄ‚îÄ visual/             # –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ bubbles.py
‚îÇ   ‚îú‚îÄ‚îÄ chart_renderer.py
‚îÇ   ‚îú‚îÄ‚îÄ altseason_gauge.py
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îÇ
‚îú‚îÄ‚îÄ main_worker.py      # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ (Worker)
‚îî‚îÄ‚îÄ main_api.py         # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ (API)
```

---

## –ü–∞—Ç—Ç–µ—Ä–Ω—ã –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### 1. Factory Pattern (–ü–∞—Ç—Ç–µ—Ä–Ω –§–∞–±—Ä–∏–∫–∞)
**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**: `HandlerFactory`

–°–æ–∑–¥–∞–µ—Ç handlers –∏ services —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏.

```python
factory = HandlerFactory(db)
handlers = factory.get_handlers()
services = factory.get_services()
```

### 2. Repository Pattern (–ü–∞—Ç—Ç–µ—Ä–Ω –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π)
**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**: `BaseRepository`, `UserRepository`, `SubscriptionRepository`

–ê–±—Å—Ç—Ä–∞–≥–∏—Ä—É–µ—Ç —Ä–∞–±–æ—Ç—É —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö.

```python
class UserRepository(BaseRepository):
    def get_user_settings(self, user_id: int):
        # –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã —Å –ë–î
        pass
```

### 3. Handler Pattern (–ü–∞—Ç—Ç–µ—Ä–Ω –û–±—Ä–∞–±–æ—Ç—á–∏–∫)
**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**: `BaseHandler`, –≤—Å–µ handlers

–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∫–æ–º–∞–Ω–¥—ã –∏ callback'–∏ –æ—Ç Telegram.

```python
class BubblesHandler(BaseHandler):
    async def handle_bubbles_command(self, update, context, tf="1h"):
        # –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥—ã
        pass
```

### 4. Service Pattern (–ü–∞—Ç—Ç–µ—Ä–Ω –°–µ—Ä–≤–∏—Å)
**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**: –í—Å–µ services –≤ `application/services/`

–°–æ–¥–µ—Ä–∂–∏—Ç –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

```python
class BubblesService:
    def generate_bubbles(self, timeframe: str) -> bytes:
        # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø—É–∑—ã—Ä—å–∫–æ–≤
        pass
```

### 5. DTO Pattern (–ü–∞—Ç—Ç–µ—Ä–Ω Data Transfer Object)
**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**: `BubblesDTO`, `BubblesSettingsDTO`

–ü–µ—Ä–µ–Ω–æ—Å–∏—Ç –¥–∞–Ω–Ω—ã–µ –º–µ–∂–¥—É —Å–ª–æ—è–º–∏.

```python
@dataclass
class BubblesSettingsDTO:
    timeframe: str
    min_mcap: float
    max_mcap: float
```

### 6. Command Pattern (–ü–∞—Ç—Ç–µ—Ä–Ω –ö–æ–º–∞–Ω–¥–∞)
**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**: `CallbackRouter`, `CallbackCommand`

–ò–Ω–∫–∞–ø—Å—É–ª–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –∫–∞–∫ –æ–±—ä–µ–∫—Ç—ã.

```python
class CallbackCommand(ABC):
    async def execute(self, update, context):
        pass
```

---

## –ü–æ—Ç–æ–∫–∏ –¥–∞–Ω–Ω—ã—Ö

### 1. –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥—ã –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

```
User ‚Üí Telegram Bot ‚Üí CommandHandler ‚Üí Service ‚Üí Repository ‚Üí Database
                                      ‚Üì
                                   Response ‚Üê Formatter ‚Üê Service
```

**–ü—Ä–∏–º–µ—Ä**: –ö–æ–º–∞–Ω–¥–∞ `/bubbles`

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç `/bubbles 1h`
2. `TelegramBot` –ø–æ–ª—É—á–∞–µ—Ç –∫–æ–º–∞–Ω–¥—É
3. `CommandIntegrator` –Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç –≤ `BubblesHandler`
4. `BubblesHandler` –≤—ã–∑—ã–≤–∞–µ—Ç `BubblesService`
5. `BubblesService` –ø–æ–ª—É—á–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ `MarketDataService`
6. `BubblesService` –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
7. `BubblesHandler` –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

### 2. –û–±—Ä–∞–±–æ—Ç–∫–∞ webhook –æ—Ç TradingView

```
TradingView ‚Üí Webhook ‚Üí API Handler ‚Üí UseCase ‚Üí Repository ‚Üí Database
```

**–ü—Ä–∏–º–µ—Ä**: –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö OHLC

1. TradingView –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç webhook
2. `main_api.py` –ø–æ–ª—É—á–∞–µ—Ç –∑–∞–ø—Ä–æ—Å
3. `ingest_bar` use case –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ
4. –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –ë–î —á–µ—Ä–µ–∑ Repository

### 3. –§–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏ (Job Queue)

```
Scheduler ‚Üí Job ‚Üí Service ‚Üí Repository ‚Üí Database
                    ‚Üì
                 Telegram Bot ‚Üí User
```

**–ü—Ä–∏–º–µ—Ä**: –ï–∂–µ—á–∞—Å–Ω–∞—è —Ä–∞—Å—Å—ã–ª–∫–∞ –ø—É–∑—ã—Ä—å–∫–æ–≤

1. `JobQueue` –∑–∞–ø—É—Å–∫–∞–µ—Ç –∑–∞–¥–∞—á—É –∫–∞–∂–¥—ã–µ 60 –º–∏–Ω—É—Ç
2. `hourly_bubbles` –ø–æ–ª—É—á–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤
3. –î–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–¥–ø–∏—Å—á–∏–∫–∞ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `BubblesService`
4. –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

---

## –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã

### 1. Telegram Bot (`infrastructure/telegram_bot.py`)

–û—Å–Ω–æ–≤–Ω–æ–π –∫–ª–∞—Å—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Telegram Bot API.

**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å**:
- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–æ—Ç–∞
- –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è handlers
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥ –∏ callback'–æ–≤
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –Ω–æ–≤–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π

**–ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç–æ–¥—ã**:
- `__init__()` - –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
- `run()` - –∑–∞–ø—É—Å–∫ –±–æ—Ç–∞
- `on_start()` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥—ã /start
- `on_ui_btn()` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ callback'–æ–≤

### 2. Handler Factory (`presentation/handlers/handler_factory.py`)

–°–æ–∑–¥–∞–µ—Ç –∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç –≤—Å–µ handlers –∏ services.

**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å**:
- –°–æ–∑–¥–∞–Ω–∏–µ services
- –°–æ–∑–¥–∞–Ω–∏–µ handlers
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏

**–ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç–æ–¥—ã**:
- `get_services()` - –ø–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö services
- `get_handlers()` - –ø–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö handlers

### 3. Command Integrator (`presentation/integration/command_integrator.py`)

–ò–Ω—Ç–µ–≥—Ä–∏—Ä—É–µ—Ç –Ω–æ–≤—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É —Å–æ —Å—Ç–∞—Ä—ã–º –∫–æ–¥–æ–º.

**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å**:
- –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è –∫–æ–º–∞–Ω–¥
- Fallback –Ω–∞ —Å—Ç–∞—Ä—ã–π –∫–æ–¥
- –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è

### 4. Database (`infrastructure/db.py`)

–†–∞–±–æ—Ç–∞ —Å SQLite –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö.

**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å**:
- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î
- –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ SQL –∑–∞–ø—Ä–æ—Å–æ–≤
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏

### 5. Market Data Service (`application/services/market_data_service.py`)

–†–∞–±–æ—Ç–∞ —Å —Ä—ã–Ω–æ—á–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ (CoinGecko).

**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å**:
- –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –æ –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–∞—Ö
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
- –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

### 6. Bubbles Service (`application/services/bubbles_service.py`)

–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø—É–∑—ã—Ä—å–∫–æ–≤—ã—Ö –¥–∏–∞–≥—Ä–∞–º–º.

**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å**:
- –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –æ –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–∞—Ö
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º

### 7. Forecast Service (`application/services/forecast_service.py`)

ML –ø—Ä–æ–≥–Ω–æ–∑—ã –¥–ª—è –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç.

**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å**:
- –ó–∞–≥—Ä—É–∑–∫–∞ ML –º–æ–¥–µ–ª–∏
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø—Ä–æ–≥–Ω–æ–∑–æ–≤
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

---

## –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –º–µ–∂–¥—É —Å–ª–æ—è–º–∏

```
Presentation Layer
    ‚Üì –∑–∞–≤–∏—Å–∏—Ç –æ—Ç
Application Layer
    ‚Üì –∑–∞–≤–∏—Å–∏—Ç –æ—Ç
Domain Layer
    ‚Üë –∑–∞–≤–∏—Å–∏—Ç –æ—Ç
Infrastructure Layer
```

**–ü—Ä–∞–≤–∏–ª–æ**: –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω—ã –≤–Ω—É—Ç—Ä—å. –í–Ω–µ—à–Ω–∏–µ —Å–ª–æ–∏ –∑–∞–≤–∏—Å—è—Ç –æ—Ç –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö, –Ω–æ –Ω–µ –Ω–∞–æ–±–æ—Ä–æ—Ç.

---

## –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–π –∫–æ–º–∞–Ω–¥—ã

1. –°–æ–∑–¥–∞—Ç—å handler –≤ `presentation/handlers/`
2. –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥ –≤ handler
3. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –≤ `HandlerFactory`
4. –î–æ–±–∞–≤–∏—Ç—å –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—é –≤ `CommandIntegrator`
5. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –≤ `TelegramBot`

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞

1. –°–æ–∑–¥–∞—Ç—å service –≤ `application/services/`
2. –î–æ–±–∞–≤–∏—Ç—å –≤ `HandlerFactory.get_services()`
3. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ handlers —á–µ—Ä–µ–∑ dependency injection

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

1. –°–æ–∑–¥–∞—Ç—å repository –≤ `infrastructure/repositories/`
2. –ù–∞—Å–ª–µ–¥–æ–≤–∞—Ç—å—Å—è –æ—Ç `BaseRepository`
3. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ services

---

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### Unit —Ç–µ—Å—Ç—ã

–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –±–µ–∑ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π.

**–ü—Ä–∏–º–µ—Ä—ã**:
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ services –±–µ–∑ –ë–î
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ handlers —Å mock services
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ domain –ª–æ–≥–∏–∫–∏

### Integration —Ç–µ—Å—Ç—ã

–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –º–µ–∂–¥—É –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏.

**–ü—Ä–∏–º–µ—Ä—ã**:
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ handlers —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ services
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ repositories —Å –ë–î
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ–≥–æ –ø–æ—Ç–æ–∫–∞ –∫–æ–º–∞–Ω–¥—ã

---

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ —Å–ª–µ–¥—É–µ—Ç –ø—Ä–∏–Ω—Ü–∏–ø–∞–º Clean Architecture, —á—Ç–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç:
- ‚úÖ –ß–∏—Å—Ç—ã–π –∏ –ø–æ–Ω—è—Ç–Ω—ã–π –∫–æ–¥
- ‚úÖ –õ–µ–≥–∫–æ—Å—Ç—å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- ‚úÖ –†–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ—Å—Ç—å

–î–ª—è –∏–∑—É—á–µ–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è:
1. –ù–∞—á–∞—Ç—å —Å `main_worker.py` - —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞
2. –ò–∑—É—á–∏—Ç—å `HandlerFactory` - —Å–æ–∑–¥–∞–Ω–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
3. –ò–∑—É—á–∏—Ç—å handlers - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥
4. –ò–∑—É—á–∏—Ç—å services - –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
5. –ò–∑—É—á–∏—Ç—å repositories - —Ä–∞–±–æ—Ç–∞ —Å –ë–î













