# MVP Implementation — Alt Forecast Bot

Документ фиксирует **фактически реализованный MVP** проекта Alt Forecast Bot.
Он описывает, какие компоненты действительно работают, какие задачи решены,
и какие архитектурные решения были приняты сознательно в рамках MVP.

Документ не является roadmap’ом и не описывает будущие планы.

---

## Цель MVP

Показать работающий сервис криптовалютной аналитики, который:

- принимает рыночные данные через TradingView webhook,
- сохраняет их в хранилище,
- предоставляет REST API и простой Web UI,
- формирует аналитические отчёты и сигналы,
- масштабируется по воркерам при необходимости.

---

## Реализованные компоненты

### 1. Доменная модель

**Реализация**
- Описана предметная область сервиса (бары, метрики, дивергенции, импликации).
- Зафиксированы инварианты и жизненные циклы сигналов.
- Домен не зависит от Telegram, HTTP, базы данных или внешних API.

**Артефакты**
- `DOMAIN_MODEL.md`
- `app/domain/models.py`
- доменные сервисы и расчёты

---

### 2. Хранилище данных

**Реализация**
- Используется SQLite в режиме WAL.
- Схема покрывает ключевые сущности MVP:
  - OHLCV бары
  - дивергенции
  - пользовательские настройки
  - подписки
- Индексы оптимизированы под чтение по `(metric, timeframe, ts)`.
- Используются транзакции и батч-запись.

**Осознанный компромисс**
SQLite выбран вместо Postgres для упрощения запуска и инфраструктуры.
Решение подходит для MVP и умеренной нагрузки.

**Артефакты**
- `app/infrastructure/db.py`
- `tests/test_database.py`

---

### 3. REST API и Webhook

**Реализация**
- FastAPI используется как единая точка входа.
- Поддерживаются следующие группы эндпоинтов:
  - чтение баров и агрегатов,
  - прогнозы BTC,
  - дивергенции,
  - служебная статистика,
  - TradingView webhook.
- Валидация входных данных через Pydantic.
- Health check для контейнеров.

**Интерактивная документация**
- Swagger UI (`/docs`)
- ReDoc (`/redoc`)

**Артефакты**
- `app/infrastructure/webhook.py`
- `app/infrastructure/rest_api.py`
- `tests/test_rest_api.py`

---

### 4. Web UI (Dashboard)

**Реализация**
- Статический HTML/JS интерфейс.
- Отображает:
  - общую статистику,
  - прогнозы BTC,
  - таблицы баров,
  - список дивергенций.
- Работает исключительно через REST API.
- Используется как демонстрационный и отладочный интерфейс.

**Артефакты**
- `app/infrastructure/static/index.html`

---

### 5. Telegram Bot (Worker)

**Реализация**
- Telegram-бот реализован как отдельный worker.
- Команды и кнопки вызывают use cases и сервисы приложения.
- Формирование отчётов и графиков вынесено из handlers.
- Worker использует общее хранилище данных.

**Артефакты**
- `app/main_worker.py`
- `app/presentation/*`

---

### 6. Тестирование

**Покрытие**
- Unit-тесты доменной логики.
- Интеграционные тесты БД.
- Тесты REST API.

**Инфраструктура**
- pytest
- фикстуры с временной БД
- изоляция тестов

**Артефакты**
- `tests/test_domain_models.py`
- `tests/test_database.py`
- `tests/test_rest_api.py`
- `tests/conftest.py`

---

### 7. Контейнеризация и запуск

**Реализация**
- Отдельные Dockerfile для:
  - API
  - Worker
- Docker Compose для локального запуска и демонстрации.
- Health checks для сервисов.
- Общий volume для базы данных.

**Артефакты**
- `Dockerfile.api`
- `Dockerfile.worker`
- `docker-compose.yml`

---

### 8. Очереди и масштабирование (опционально)

**Реализация**
- RabbitMQ используется как очередь задач.
- Выделен отдельный тип воркеров для тяжёлых задач прогнозирования.
- Возможен запуск нескольких `worker-forecast` параллельно.

**Важно**
Очереди не являются обязательной частью MVP и используются
только при необходимости масштабирования.

**Артефакты**
- `app/infrastructure/queue.py`
- `app/infrastructure/forecast_worker.py`
- конфигурация RabbitMQ в `docker-compose.yml`

---

## Архитектурная схема MVP

                TradingView
                   |
                   | webhook
                   v
             +--------------+
             |   FastAPI    |
             |     API      |
             |  /webhook   |
             |  /api/*     |
             |  / (UI)     |
             +------+-------+
                    |
                    v
             +--------------+
             |   SQLite     |
             |   (WAL)      |
             +------+-------+
                    ^
                    |
             +------+-------+
             |   Worker     |
             |  Telegram    |
             |     Bot      |
             +------+-------+
                    |
                    v
             +--------------+
             |  RabbitMQ    |
             | (optional)   |
             +--------------+


---


## Вывод

MVP представляет собой работающую систему со сквозным потоком данных:
от входящих рыночных событий до аналитических отчётов и пользовательского интерфейса.

Архитектура позволяет:
- тестировать бизнес-логику изолированно,
- масштабировать вычислительные части,
- расширять модель без переписывания ядра.






